## 强化学习示例[01-10]

推荐文章：【控制理论】【随机控制理论】(https://jb243.github.io/pages/895) 

---

<br>

## Q4。

考虑状态空间 𝒮 = {1, 2, ..., I} 上的有限状态遍历离散时间马尔可夫链 {X<sub>t</sub>}<sub>t∈Z<sub>+</sub></sub> ，具有转移矩阵 P 和初始分布 μ（对于 X<sub>0</sub>）。对于（有界）成本向量 C，令 (L, J) 为 (C, P) 的泊松方程的（有界）解，即 (L, J) 满足（向量）方程

<br>

<center>L + 1<b>J</b> = C + PL</center>

<br>

然后显示以下内容： 

(a) 上式可写为 

<br>

<center>L(X<sub>t</sub>) + J = C(X<sub>t</sub>) + 𝔼[L(X<sub>t+1</sub>) ㅣ X<sub>t</sub>]</center>

<br>

其中，如果 X<sub>t</sub> = i，则 L(X<sub>t</sub>) = L(i)（列向量 L 的第 i<sup>t</sup> 分量）。

(b) 然后，使用马尔可夫性质表明随机过程 {M<sub>t</sub>}<sub>t∈Z<sub>+</sub></sub> 给出 

<br>

<center>M<sub>0</sub> := L(X<sub>0</sub>), M<sub>t+1</sub> := L(X<sub>t+1</sub>) + Σ<sub>s=0 到 t</sub> C(X<sub>s</sub>) - (t+1) J, t = 0, 1, 2, ···</center>

<br>

是关于过滤的鞅 {ℱ<sub>t</sub>}<sub>t∈Z<sub>+</sub></sub>，其中 ℱ<sub>t</sub> = σ(X<sub>0</sub>, X<sub>1</sub>, ..., X<sub>t</sub>)。由于 𝔼[ㅣM<sub>t</sub>ㅣ] < +∞ 由 C、L 和 J 有界性得出，您只需证明性质 (2)——适应性，即 M<sub>t</sub> 是 ℱ<sub>t</sub> 可测量——，并且(3)―𝔼[M<sub>t+1</sub>ㅣℱ<sub>t</sub>] = M<sub>t</sub> w.p. 1. 对于性质 (3)，您需要使用本问题的 (a) 部分。 

## A4。 

(一) 

让我们检查给定泊松方程的维数 

<br>

<img width="706" height="181" alt="스크린샷 2025-12-26 오후 10 26 12" src="https://github.com/user-attachments/assets/6f6912f3-3591-463d-b3bf-6225a830e2a6" />

<br>

这里，P(i,j)（第i行，第j列）表示转移概率ℙ(jㅣi)。因此，方程的第 i 个分量是

<br>

<center>L(i) + J = C(i) + Σ<sub>j=1 to I</sub> P(i,j)·L(j) = C(i) + 𝔼[L(j)ㅣi)</center>

<br>

等价地，给定 X<sub>t</sub> = i，它可以表示为

<br>

<center>L(X<sub>t</sub>) + J = C(X<sub>t</sub>) + 𝔼[L(X<sub>t+1</sub>)ㅣX<sub>t</sub>)</center>

<br>

根据转换的含义，我将 L(j) 替换为 L(X<sub>t+1</sub>)。

(二) 

M<sub>0</sub> = L(X<sub>0</sub>sub>) （可通过 X<sub>0</sub> 测量）

M<sub>1</sub> = L(X<sub>1</sub>) + C(X<sub>0</sub>) - J（可通过 X<sub>0:1</sub> 测量）

M<sub>2</sub> = L(X<sub>2</sub>) + C(X<sub>0</sub>) + C(X<sub>1</sub>) - 2J（可通过 X<sub>0:2</sub> 测量）

一般来说，当 X<sup>-1</sup>(A) = {w ε Ω : X(w) ε A} ε ℱ ∀ A ε 𝒢 给定一对 (Ω, ℱ) 和 (ℝ, 𝒢) 时，X: Ω → ℝ 是可测量的。值得注意的是，可测量性可以在没有测量 ℙ 的情况下定义，并且 𝒢 通常设置为 𝒢 = ℬ(ℝ)，其中 ℬ 是 Borel σ 代数。根据上述观察，我们可以以同样的理由考虑 X<sub>0:t</sub> 对于 M<sub>t</sub> 的反函数，特别是在有限阶段和有限状态集以及反函数范围的存在性的情况下。因此，M<sub>t</sub> 是 ℱ<sub>t</sub> 可测量的。

显然，ℱ<sub>0</sub> ⊆ ℱ<sub>1</sub> ⊆ ℱ<sub>2</sub> ⊆ ⋯ (∵ σ(X<sub>0:t-1</sub>) ⊆ σ(X<sub>0:t</sub>))，因此我们可以找到过滤的适应性属性。所以问题是 𝔼[M<sub>t+1</sub>ㅣℱ<sub>t</sub>] = M<sub>t</sub> 是否为真。这意味着 M<sub>t+1</sub> 的最佳预测可以投影到 ℱ<sub>t</sub> 可测空间上，这有利于在当前条件下进行未来预测。使用(a)，我们得到

<br>

<img width="590" height="379" alt="스크린샷 2025-12-26 오후 11 50 27" src="https://github.com/user-attachments/assets/30c673b6-bcd0-405d-a839-7e4d8a9d049d" />

<br>此处，Doob 定理指出 σ(X<sub>1</sub>, ..., X<sub>n</sub>) 与具有 g(X<sub>1</sub>, ..., X<sub>n</sub>) 形式的任何函数相同。具有过滤性质 {ℱ<sub>t</sub>}<sub>t∈ℤ<sub>+</sub></sub> 和已经证明的属性 (1)、(2) 和 (3)，{M<sub>t</sub>}<sub>t∈ℤ<sub>+</sub></sub> 是鞅。

<br>

<br>

<br>

## Q5。

令 (X<sub>t</sub>)<sub>t≥0</sub> 为状态空间为 S 的随机过程。令 P 为函数 f : S → ℝ 上的转移算子，并令 I 表示恒等算子。对于每个有界函数 f : S → ℝ，定义

M<sub>t</sub><sup>f</sup> = f(X<sub>t</sub>) - f(X<sub>0</sub>) - Σ<sub>τ = 0 到 (t-1)</sub> (P - I)f(X<sub>τ</sub>),

设 ℱ<sub>t</sub> = σ(X<sub>0</sub>, …, X<sub>t</sub>) 为 X 生成的自然过滤。证明以下两个语句是等价的：

1. (X<sub>t</sub>)<sub>t≥0</sub>是一个带有转移算子P的马尔可夫链。

2. 对于每个有界函数 f，过程 (M<sub>t</sub><sup>f</sup>)<sub>t≥0</sub> 是相对于过滤 (ℱ<sub>t</sub>)<sub>t≥0</sub> 的鞅。

## A5。

_证明 1 → 2_

M<sub>t+1</sub><sup>f</sup> - M<sub>t</sub><sup>f</sup> = f(X<sub>t+1</sub>) - f(X<sub>t</sub>) - (P-I)f(X<sub>t</sub>) = f(X<sub>t+1</sub>) - Pf(X<sub>t</sub>)

如果 (X<sub>t</sub>) 是具有转移概率矩阵 P 的马尔可夫链，则 𝔼[f(X<sub>t+1</sub>) ㅣ ℱ<sub>t</sub>] = Pf(X<sub>t</sub>)

∴ 𝔼[M<sub>t+1</sub><sup>f</sup> - M<sub>t</sub><sup>f</sup> ㅣ ℱ<sub>t</sub>] = 𝔼[f(X<sub>t+1</sub>) - Pf(X<sub>t</sub>) ㅣ ℱ<sub>t</sub>] = 0

∴ 𝔼[M<sub>t+1</sub><sup>f</sup> ㅣ ℱ<sub>t</sub>] = M<sub>t</sub><sup>f</sup>，所以 M<sub>t</sub><sup>f</sup> 是鞅。

<br>

_2 → 1 的证明_

M<sub>t+1</sub><sup>f</sup> - M<sub>t</sub><sup>f</sup> = f(X<sub>t+1</sub>) - f(X<sub>t</sub>) - (P-I)f(X<sub>t</sub>) = f(X<sub>t+1</sub>) - Pf(X<sub>t</sub>)

由于 M<sub>t</sub><sup>f</sup> 是鞅，所以 𝔼[M<sub>t+1</sub><sup>f</sup> - M<sub>t</sub><sup>f</sup> ㅣ ℱ<sub>t</sub>] = 𝔼[f(X<sub>t+1</sub>) - Pf(X<sub>t</sub>) ㅣ ℱ<sub>t</sub>] = 0

即，对于所有有界 f，成立 𝔼[f(X<sub>t+1</sub>) ㅣ ℱ<sub>t</sub>] = Pf(X<sub>t</sub>)。

它表明，如果给定总的过去历史ℱ<sub>t</sub>，则下一个分布仅由X<sub>t</sub>决定。 → 1 步马尔可夫性质。

如果重复应用，则成立𝔼[g(X<sub>t+k</sub>) ㅣ ℱ<sub>t</sub>] = P<sup>k</sup>g(X<sub>t</sub>)，即总马尔可夫性质。

<br>

<br>

## Q8。 

在抛硬币游戏中，个人的赔率为 3 比 1，只要出现反面，她就获胜。然而，她怀疑硬币是有偏差的，并且对于每次抛掷出现正面的概率 p，具有 CDF F(p) 和 pdf f(p) 的先验概率分布。最多允许掷 T 枚硬币。个人的目标是根据迄今为止的游戏结果来确定决定是否继续或停止参与游戏的策略，以最大化她的收入。

(i) 确定问题的信息状态并写下确定其演化的方程。

(ii) 写出该问题的动态规划。

## A8。

信息状态可以定义为后验概率ℙ(结果ㅣ先验)。

**情况 1.** 对于一般信息状态，

<br>

<img width="658" height="257" alt="스크린샷 2025-11-23 오후 4 54 06" src="https://github.com/user-attachments/assets/c87c2e34-0270-4a64-9710-ab0b2b064a45" />

<br>

**情况1.** 对于具体信息状态，

<br>

<img width="703" height="353" alt="스크린샷 2025-11-23 오후 4 52 32" src="https://github.com/user-attachments/assets/b507139c-5ff2-44dd-863f-d6c91b54e452" />

<br>

<br>

## Q9。证明 W<sub>∞</sub>(i), i=1,…,I 是线性规划的解： 最大化 Σ<sub>i=1 至 I</sub> z(i) 且满足 z(i) ≤ c(i,u) + βΣ<sub>j=1 至 I</sub> P<sub>ij</sub>(u) z(j), ∀u,i

## A9。

令 β ε (0, 1)、概率转移矩阵 P(u) 和一步成本 c 给出。定义 Bellman 算子 T 为 

<br>

<center>(Tv)(i) = min<sub>u</sub> { c(i, u) + β Σ<sub>j</sub> P<sub>ij</sub>(u) v(j) }</center>

<br>

W<sub>∞</sub> 是该方程的唯一不动点：W<sub>∞</sub> = TW<sub>∞</sub>。对于所有的我和你，我们有

<br>

<center>W∞(i) = min<sub>u'</sub> { c(i, u') + β Σ<sub>j</sub> P<sub>ij</sub>(u') W<sub>∞</sub>(j) } ≤ c(i, u) + β Σ<sub>j</sub> P<sub>ij</sub>(u) W<sub>∞</sub>(j)</center>

<br>

所以 W<sub>∞</sub>(i) 也满足给定的不等式约束。由于约束对所有 u 都成立，因此我们有

<br>

<center>z(i) ≤ c(i, u) + β Σ<sub>j</sub> P<sub>ij</sub>(u) z(j) 对于所有 u ⇒ z(i) ≤ (Tz)(i)</center>

<br>

这里我们可以看到算子T的单调性： 

<br>

<center>x ≤ y ⇒ c(i, u) + β Σ<sub>j</sub> P<sub>ij</sub>(u) x(j) ≤ c(i, u) + β Σ<sub>j</sub> P<sub>ij</sub>(u) y(j) ⇒ (Tx)(i) ≤ (Ty)(i)</center>

<br>

因此，z ≤ Tz ≤ T<sup>2</sup>z ≤ ... ≤ lim<sub>n→∞</sub> T<sup>n</sup>z = W<sub>∞</sub>。 Banach不动点定理和贝尔曼收缩映射已经保证了W∞的唯一性以及任何z收敛于W<sub>∞</sub>的事实。此外，任何可行的 z 的边界如下：

<br>

<center>||z||<sub>∞</sub> ≤ max<sub>i,u</sub> c(i, u) + β ||z||<sub>∞</sub> ⇔ ||z||<sub>∞</sub> ≤ max<sub>i,u</sub> c(i, u) / (1 − β)</center>

<br>

因此 Σ<sub>i</sub> z(i) ≤ Σ<sub>i</sub> W<sub>∞</sub>(i)。综上所述，W<sub>∞</sub>是满足给定线性规划约束的可行解，并且由于对于所有可行z，z ≤ W<sub>∞</sub>，因此最大化Σ<sub>i</sub> z(i)的解是z = W<sub>∞</sub>，并且该W<sub>∞</sub>是唯一的。

<br>

<br>

## Q10。

证明最小成本是线性规划的解：在 J\* + w(i) ≤ c(i,u) + Σ<sub>j=1 to I</sub> P<sub>ij</sub>(u)w(j) 的条件下最大化 J\*，1 ≤ i ≤ I，u ∈ U。

## A10。

我们可以定义 J<sub>opt</sub>\* 如下： J<sub>opt</sub>\* + h(i) = min<sub>u∈U</sub> {c(i,u) + Σ<sub>j</sub> P<sub>ij</sub>(u)h(j)}, ∀i。如果我们设置w(i) = h(i)，我们知道J<sub>opt</sub>\*，这是LP可行解，实现了最小成本，这意味着 

<br>

<img width="342" height="83" alt="스크린샷 2025-11-23 오후 6 17 00" src="https://github.com/user-attachments/assets/eec71741-3dfc-49f8-81f9-2ede93d90aee" />

<br>

对于任意 i、u 和 LP 可行解 L，我们有

<br>

<img width="650" height="239" alt="스크린샷 2025-11-23 오후 6 20 29" src="https://github.com/user-attachments/assets/c263a250-d760-4bf6-8363-2b3f4852904e" />

<br>

令 g 为**最优固定策略**，其长期平均成本为 J<sub>opt</sub>*。然后 

<br>

<img width="451" height="117" alt="스크린샷 2025-11-23 오후 6 23 00" src="https://github.com/user-attachments/assets/c7542dbd-6944-4e9b-a62e-a484907413d1" />

<br>

在这里，我使用了样本路径最优性（更强的说法），它可以从 Martingale 差分序列（MDS）导出。令 J\* := su{J ㅣ ∃w s.t. (J,w)是LP可行}是LP的最优值。由于对于每个 LP 可行 J，J<sub>opt</sub>\* ≥ J，我们有 J<sub>opt</sub>\* ≥ J\*。因此，贝尔曼最优性方程中的最小成本 J<sub>opt</sub>\* 与 max J\* s.t. 中的 J\* 相同。 J\* + w(i) ≤ c(i, u) + Σ<sub>j</sub> P<sub>ij</sub>(u) w(j)。

<br>

---

_输入：2025.11.21 01:30_